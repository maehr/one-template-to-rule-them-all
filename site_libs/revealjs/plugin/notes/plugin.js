import h from"./speaker-view.html";import{marked as y}from"marked";const v=()=>{let d,n=null,o;function c(){if(n&&!n.closed)n.focus();else{if(n=window.open("about:blank","reveal.js - Notes","width=1100,height=700"),n.marked=y,n.document.write(h),!n){alert("Speaker view popup failed to open. Please make sure popups are allowed and reopen the speaker view.");return}w()}}function u(a){n&&!n.closed?n.focus():(n=a,window.addEventListener("message",p),f())}function w(){const a=o.getConfig().url,e=typeof a=="string"?a:window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search;d=setInterval(function(){n.postMessage(JSON.stringify({namespace:"reveal-notes",type:"connect",state:o.getState(),url:e}),"*")},500),window.addEventListener("message",p)}function m(a,e,t){let i=o[a].apply(o,e);n.postMessage(JSON.stringify({namespace:"reveal-notes",type:"return",result:i,callId:t}),"*")}function s(a){let e=o.getCurrentSlide(),t=e.querySelectorAll("aside.notes"),i=e.querySelector(".current-fragment"),r={namespace:"reveal-notes",type:"state",notes:"",markdown:!1,whitespace:"normal",state:o.getState()};if(e.hasAttribute("data-notes")&&(r.notes=e.getAttribute("data-notes"),r.whitespace="pre-wrap"),i){let l=i.querySelector("aside.notes");l?(r.notes=l.innerHTML,r.markdown=typeof l.getAttribute("data-markdown")=="string",t=null):i.hasAttribute("data-notes")&&(r.notes=i.getAttribute("data-notes"),r.whitespace="pre-wrap",t=null)}t&&t.length&&(t=Array.from(t).filter(l=>l.closest(".fragment")===null),r.notes=t.map(l=>l.innerHTML).join(`
`),r.markdown=t[0]&&typeof t[0].getAttribute("data-markdown")=="string"),n.postMessage(JSON.stringify(r),"*")}function g(a){try{return window.location.origin===a.source.location.origin}catch{return!1}}function p(a){if(g(a))try{let e=JSON.parse(a.data);e&&e.namespace==="reveal-notes"&&e.type==="connected"?(clearInterval(d),f()):e&&e.namespace==="reveal-notes"&&e.type==="call"&&m(e.methodName,e.arguments,e.callId)}catch{}}function f(){o.on("slidechanged",s),o.on("fragmentshown",s),o.on("fragmenthidden",s),o.on("overviewhidden",s),o.on("overviewshown",s),o.on("paused",s),o.on("resumed",s),s()}return{id:"notes",init:function(a){o=a,/receiver/i.test(window.location.search)||(window.location.search.match(/(\?|\&)notes/gi)!==null?c():window.addEventListener("message",e=>{if(!n&&typeof e.data=="string"){let t;try{t=JSON.parse(e.data)}catch{}t&&t.namespace==="reveal-notes"&&t.type==="heartbeat"&&u(e.source)}}),o.addKeyBinding({keyCode:83,key:"S",description:"Speaker notes view"},function(){c()}))},open:c}};export default v;
